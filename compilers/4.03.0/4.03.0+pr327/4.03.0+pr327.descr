Solve new performance problems of PR#6542