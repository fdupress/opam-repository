Small improvements to type-based optimizations (array, lazy)