Fix PR#7305 by making fix of PR#5663 more efficient